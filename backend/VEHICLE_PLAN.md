# План реализации каталога автомобилей

## 1. Структура БД (✅ Реализовано)

### Модели данных:
- **VehicleBrand** - Марки автомобилей
  - externalId (ID из cars.json)
  - name (английское название)
  - nameCyrillic (название на кириллице)
  - slug (для URL)
  - country (страна производителя)
  - popular (популярная марка)
  - logo (путь к логотипу)
  
- **VehicleModel** - Модели автомобилей
  - externalId (ID из cars.json)
  - brandId (связь с маркой)
  - name (английское название)
  - nameCyrillic (название на кириллице)
  - slug (для URL)
  - class (A, B, C, D, E, S и т.д.)
  - yearFrom (год начала производства)
  - yearTo (год окончания, null если производится)
  
- **ProductVehicle** - Связь товаров с моделями
  - productId
  - vehicleModelId
  - fitmentNotes (примечания по установке)
  - isUniversal (подходит для всех комплектаций)

## 2. Импорт данных (✅ Скрипт создан)

- Скрипт `prisma/import-vehicles.ts` импортирует данные из `files/cars.json`
- Команда для запуска: `npm run prisma:import-vehicles`
- Импортируется ~150 марок и ~3000 моделей автомобилей

## 3. Backend реализация

### 3.1 Модули NestJS:
- **VehicleBrandsModule**
  - CRUD операции для марок
  - Получение популярных марок
  - Поиск по названию
  
- **VehicleModelsModule**
  - CRUD операции для моделей
  - Фильтрация по марке
  - Фильтрация по годам производства
  - Фильтрация по классу авто

### 3.2 API Endpoints:
```
GET /vehicle-brands - список марок
GET /vehicle-brands/popular - популярные марки
GET /vehicle-brands/:slug - марка по slug
GET /vehicle-brands/:slug/models - модели марки

GET /vehicle-models - список моделей
GET /vehicle-models/:slug - модель по slug
GET /vehicle-models/by-class/:class - модели по классу

POST /products/:id/vehicles - привязать товар к моделям
GET /products/by-vehicle/:modelId - товары для модели
```

## 4. Frontend реализация

### 4.1 Страницы:
- `/vehicles` - каталог марок автомобилей
- `/vehicles/[brand]` - модели выбранной марки
- `/vehicles/[brand]/[model]` - информация о модели и подходящие товары

### 4.2 Компоненты:
- **VehicleSelector** - компонент выбора автомобиля
  - Шаг 1: Выбор марки (с поиском)
  - Шаг 2: Выбор модели
  - Шаг 3: Выбор года выпуска
  - Сохранение в профиле пользователя

- **VehicleFilter** - фильтр товаров по автомобилю
- **ProductVehicleCompatibility** - отображение совместимости на карточке

### 4.3 Интеграция:
- Добавить фильтр по автомобилю в каталог товаров
- Показывать badge "Подходит для вашего авто"
- Быстрый подбор с главной страницы

## 5. Дополнительный функционал (будущее)

- Поиск по VIN коду
- Рекомендации по обслуживанию
- История замен для конкретного авто
- Интеграция с TecDoc для точного подбора

## 6. Порядок реализации

1. ✅ Создать схему БД
2. ✅ Создать скрипт импорта
3. ⏳ Выполнить миграцию и импорт данных
4. ⏳ Реализовать backend модули
5. ⏳ Создать API endpoints
6. ⏳ Реализовать frontend страницы
7. ⏳ Создать компонент выбора авто
8. ⏳ Интегрировать с каталогом товаров
9. ⏳ Добавить тестовые данные связей товар-автомобиль