# Progress & TODO

Этот файл используется для отслеживания прогресса разработки интернет-магазина АСО и планирования задач.

## Completed Tasks

### Initial Setup (2024-06-17)
- ✅ Создана структура монорепозитория
- ✅ Инициализирован корневой package.json с npm workspaces
- ✅ Установлен и настроен NestJS 11 для backend
- ✅ Установлен и настроен Next.js 15 для frontend  
- ✅ Настроены скрипты для запуска проектов
- ✅ Инициализирован Git репозиторий
- ✅ Создан .gitignore файл
- ✅ Создан CLAUDE.md с инструкциями для будущей разработки
- ✅ Создан progress.md для отслеживания задач

### Backend Infrastructure (2024-06-17)
- ✅ Установлен Prisma ORM и PostgreSQL драйвер
- ✅ Создан Prisma сервис в NestJS (глобальный модуль)
- ✅ Установлен и настроен Swagger для API документации
- ✅ Установлены зависимости для JWT авторизации (passport, passport-jwt)
- ✅ Установлены и настроены пакеты для валидации (class-validator, class-transformer)
- ✅ Настроен CORS для режима разработки (разрешены все источники)
- ✅ Создана базовая схема БД в Prisma с моделями:
  - User (поддержка анонимных и авторизованных)
  - Session (для управления сессиями)
  - Category (иерархическая структура)
  - Product с Specification
  - Vehicle (Brand, Model, Generation)
  - Cart и CartItem
  - Favorite
  - Order с динамическими статусами
  - DeliveryMethod и PaymentMethod (управляемые)
  - Chat и ProductOffer
- ✅ Создан .env.example файл

### Frontend UI Setup (2024-06-17)
- ✅ Добавлены иконки и логотип проекта в структуру Next.js
- ✅ Создан компонент Logo для использования в приложении
- ✅ Обновлен layout с логотипом в header
- ✅ Настроены favicon и иконки для всех платформ
- ✅ Создан manifest.json для PWA поддержки
- ✅ Исправлена проблема с импортами в Next.js 15
- ✅ Установлены @heroicons/react для иконок интерфейса
- ✅ Создан адаптивный компонент Header с mobile-first подходом:
  - Мобильная версия: меню, логотип, телефон, личный кабинет
  - Планшетная версия: добавлен адрес и номер телефона
  - Десктопная версия: верхнее меню, каталог, поиск, избранное, корзина
- ✅ Интегрирован Header в основной layout
- ✅ Созданы заглушки для всех страниц (каталог, о компании, контакты, корзина)

### Database Updates (2025-06-17)
- ✅ Обновлена схема БД:
  - Удален isAnonymous из модели User
  - Создана отдельная модель AnonymousUser
  - Добавлена модель OtpCode для SMS верификации
  - Обновлены связи Cart, Favorite, Chat для поддержки обоих типов пользователей
  - Добавлены необязательные поля firstName, lastName, middleName к User

### Authentication System (2025-06-17)
- ✅ Реализован модуль авторизации на backend:
  - JWT сервис с тремя типами токенов (access, refresh, anonymous)
  - Anonymous user service для создания и управления анонимными пользователями
  - Auth controller с endpoints для анонимных токенов
  - Настроены JWT стратегии для passport
  - Токены анонимных пользователей живут 365 дней
  - OTP сервис с поддержкой 5 попыток ввода кода
  - Автоматическое создание пользователя при первой отправке OTP
  - Слияние данных анонимного пользователя при авторизации
- ✅ Реализована система анонимных токенов на frontend:
  - Route Handler `/api/auth/anonymous` для управления токенами
  - Синхронизация между httpOnly cookies и localStorage
  - AnonymousTokenProvider для автоматической инициализации
  - useAnonymousToken hook для React компонентов
  - Middleware для добавления токенов в заголовки запросов
  - API клиент с автоматической поддержкой токенов
- ✅ Реализована двухшаговая авторизация на frontend:
  - Установлен и настроен shadcn/ui для Next.js 15
  - Создан кастомный компонент PhoneInput с маской (React 19 совместимый)
  - Компонент AuthForm с вводом телефона и OTP кода
  - Использован input-otp для ввода 6-значного кода
  - AuthModal для модального окна авторизации
  - AuthContext для управления состоянием пользователя
  - Интеграция в Header с отображением статуса
  - Страница личного кабинета с профилем пользователя
  - В dev режиме OTP код отображается в форме

## TODO - High Priority

### Backend Infrastructure
- [x] Установить и настроить PostgreSQL
- [x] Установить и настроить Prisma ORM
- [x] Создать базовую схему БД (users, sessions, products, carts, orders)
- [x] Настроить Swagger для API документации
- [x] Настроить CORS для режима разработки
- [x] Реализовать JWT авторизацию
- [x] Создать систему анонимных сессий

### Frontend Infrastructure
- [x] Настроить структуру папок и компонентов
- [x] Установить и настроить axios/fetch wrapper для API
- [x] Создать базовые layouts (главная, каталог, личный кабинет)
- [x] Настроить систему роутинга
- [ ] Реализовать state management для корзины и пользователя

### Authentication & Users
- [ ] SMS провайдер для отправки кодов
- [x] API endpoints для анонимных токенов
- [x] API endpoints для регистрации/авторизации по SMS
- [x] Миграция анонимной сессии к пользователю
- [x] Личный кабинет пользователя

## TODO - Medium Priority

### Product Catalog
- [ ] Модель данных для категорий (иерархическая)
- [ ] Модель данных для товаров с характеристиками
- [ ] Связь товаров с марками/моделями авто
- [ ] API для каталога с фильтрацией и пагинацией
- [ ] UI каталога с фильтрами
- [ ] Поиск по товарам

### Shopping Features
- [ ] Корзина (backend + frontend)
- [ ] Избранное (backend + frontend)
- [ ] Сравнение товаров

### Orders
- [ ] Управляемые статусы заказов (admin panel)
- [ ] Методы доставки (настраиваемые)
- [ ] Методы оплаты (настраиваемые)
- [ ] Оформление заказа (checkout flow)
- [ ] История заказов

## TODO - Low Priority

### Expert Chat System
- [ ] WebSocket сервер для real-time чата
- [ ] Модель данных для чатов и сообщений
- [ ] UI чата для клиентов
- [ ] Интерфейс менеджера для чатов
- [ ] Товарные предложения (ProductOffers)
- [ ] Интеграция товарных предложений с корзиной

### Admin Panel
- [ ] Управление товарами
- [ ] Управление заказами
- [ ] Управление пользователями
- [ ] Настройки магазина (статусы, доставка, оплата)
- [ ] Статистика и аналитика

### Performance & Optimization
- [ ] Redis для кеширования
- [ ] Оптимизация изображений
- [ ] CDN интеграция
- [ ] SEO оптимизация
- [ ] PWA функционал

## Notes & Decisions

### Архитектурные решения
- Используем анонимные сессии для улучшения UX - пользователи могут добавлять в корзину без регистрации
- Товарные предложения - отдельная сущность для гибкости в чатах с менеджерами
- Управляемые статусы/методы доставки/оплаты для масштабируемости бизнеса

### Технические заметки
- Prisma выбрана для type-safety и удобства миграций
- SMS авторизация вместо email для упрощения процесса
- WebSockets для чата вместо polling для real-time опыта

## Current Sprint Focus

Текущий фокус: базовая инфраструктура и UI компоненты
1. ✅ PostgreSQL + Prisma setup
2. ✅ Базовая схема БД
3. ✅ Swagger документация
4. ✅ Базовые UI компоненты (Header, Logo)
5. ✅ JWT авторизация + анонимные сессии
6. ✅ Система анонимных токенов (backend + frontend)
7. ✅ Двухшаговая авторизация по SMS
8. ✅ Личный кабинет пользователя
9. Следующие шаги:
   - Базовые API endpoints для каталога товаров
   - State management для корзины
   - Главная страница с товарами
   - Категории и фильтры товаров
   - SMS провайдер для production